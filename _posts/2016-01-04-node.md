---
layout: post
title: node服务器的研究
category: node server
tags: node cluster
keywords: node, cluster
---

##node服务器集群
这边文章主要讨论是node服务器放面的研究，这里做一些要点学习笔记

本文目录结构：		
1. cluster

<!--break--> 

###1. cluster
通过对[cluster](https://github.com/nodejs/node/blob/master/lib/cluster.js)的研究，发现node-cluster只负责创建node进程，以及进程间的通信。而多个进程之间的负载均衡是操作系统调度的。

>The cluster module supports two methods of distributing incoming connections. 		
>1. The first one (and the default one on all platforms except Windows), is the round-robin approach, where the master process listens on a port, accepts new connections and distributes them across the workers in a round-robin fashion, with some built-in smarts to avoid overloading a worker process. 		
>2. The second approach is where the master process creates the listen socket and sends it to interested workers. The workers then accept incoming connections directly. 	
>来源：<https://nodejs.org/dist/latest-v5.x/docs/api/cluster.html#cluster_how_it_works>

####cluster支持两种负载均衡：
1. master监听端口，当请求来临时，master决定调用某个worker实现处理业务
2. master创建多个worker，多个worker监听同一个端口，当请求来临时由系统默认的调度算法选择某个worker进程处理业务。但是这种存在一个问题：系统往往考虑到`进程上下文切换`的问题，会将多个请求一次发给一个`空闲worker进程`。

####tips：
1. linux2.6已经修复`惊群`问题
2. 多个进程之间是可以同时监听一个socket端口的，这属于`端口复用`

####参考文章
1. Node.js V0.12新特性之Cluster轮转法负载均衡:<http://www.infoq.com/cn/articles/nodejs-cluster-round-robin-load-balancing>
